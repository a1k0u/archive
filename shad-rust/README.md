# Rust

## –õ–µ–∫—Ü–∏—è 2. Lifetimes, ownership & borrow checker

Vec ‚Äî –ª–µ–∂–∏—Ç –Ω–∞ –∫—É—á–µ, —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞—á–∞–ª–æ, —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–≤—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –∏ –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –ø–∞—Ä–∞–¥–∏–≥–º–∞ RAII.

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ –µ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** ([–∞–Ω–≥–ª.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA)¬†*Resource Acquisition Is Initialization (RAII)*)¬†‚Äî [–ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∏–¥–∏–æ–º–∞](https://ru.wikipedia.org/wiki/%D0%98%D0%B4%D0%B8%D0%BE%D0%BC%D0%B0_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)),
 —Å–º—ã—Å–ª –∫–æ—Ç–æ—Ä–æ–π –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ö –∏–ª–∏ –∏–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö
 –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω–æ —Å–æ–≤–º–µ—â–∞–µ—Ç—Å—è —Å 
–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π, –∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ¬†‚Äî —Å —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –≤ —Ñ—É–Ω–∫—Ü–∏—é (–ø–æ –∑–Ω–∞—á–µ–Ω–∏—é, –∞ –Ω–µ –ø–æ —Å—Å—ã–ª–∫–µ)? –£ –Ω–∞—Å –∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫–æ—É–ø–æ–≤, –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä?

```rust
fn sum(v: Vec<i32>) -> i32 {
	v.iter().sum()
}

fn main() {
	let v = vec![1, 2, 3];
	println!("{}", sum(v));
}
```

–í C++ –Ω–∞ `sum(v)` –±—ã–ª –±—ã –≤—ã–∑–≤–∞–Ω copy-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏ the end (–¥–≤–∞ —Ç–µ—Å—Ç—Ä—É–∫—Ç—Ä–∞, –≤ main –∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏), –≤ Rust –∏–Ω–∞—á–µ. –ù–æ –≤ Rust –º—ã –º—É–≤–∞–µ–º –Ω–∞—à –≤–µ–∫—Ç–æ—Ä –≤ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤ –¥—Ä—É–≥—É—é –ø–∞–º—è—Ç—å).

- –í Rust move - —ç—Ç–æ memcpy (–∫–æ–ø–∏—Ä—É–µ–º —Å–æ —Å—Ç–µ–∫–∞, –≤ —Å–ª—É—á–∞–µ –≤–µ–∫—Ç–æ—Ä–∞ ‚Äî —ç—Ç–æ —Ç—Ä–∏ —á–∏—Å–ª–∞, —É–∫–∞–∑–∞—Ç–µ–ª—å, –¥–ª–∏–Ω–∞ –∏ –∫–∞–ø–∞—Å–∏—Ç–∏)
- –í C++ –≤ –∫–æ—Ü–Ω–µ —Å–∫–æ—É–ø–∞ –ø–æ–∑–æ–≤–µ—Ç—Å—è destructor –¥–∞–∂–µ —É moved value, –≤ Rust - –Ω–µ—Ç
- –í –†–∞—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ moved value - –æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

<aside>
üí° –õ—é–±–æ–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ - —ç—Ç–æ move

</aside>

```rust
let v = vec![1, 2, 3];
let v2 = v;
let v3 = v2;
println!("{:?}", v); // invalid
println!("{:?}", v2); // invalid
println!("{:?}", v3); // OK
```

- Clone - trait (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –æ–±—Å—É–¥–∏–º –¥–∞–ª–µ–µ), –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ —Ç–∏–ø—ã, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–µ–π –ø–æ–ª–Ω–æ–π –∫–æ–ø–∏–∏
- .clone() –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ –¥–æ—Ä–æ–≥–∏–º (–∞–ª–ª–æ–∫–∞—Ü–∏–∏, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã, –ø–æ—ç—Ç–æ–º—É —Å–ª–æ–∂–Ω–æ)

–ü—Ä–∏–º–µ—Ä—ã Clone-—Ç–∏–ø–æ–≤

- –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã: f32, f64, bool, i8, u8, ...
- Vec, String, HashMap (`–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è Clone`)
- –ö–æ—Ä—Ç–µ–∂–∏ Clone-—Ç–∏–ø–æ–≤: (String, isize)
- –ú–∞—Å—Å–∏–≤—ã Clone-—Ç–∏–ø–æ–≤: [Vec<String>; 16]
- –ü–æ—á—Ç–∏: File, TcpStream (try_clone) (`—Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ, dup2 –º–æ–∂–µ—Ç –ø—Ä–æ–≤–æ–ª–∏—Ç—å—Å—è`)
- –õ—é–±–æ–π –≤–∞—à —Ç–∏–ø, –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è—é—Ç—Å—è Clone:

```rust
#[derive(Clone)]
struct Foo {
	lines: Vec<String>,
	count: usize,
}
```

try_clone –¥–ª—è –ø–∞–º—è—Ç–∏ (–≤–µ–∫—Ç–æ—Ä, —Ö–µ—à-–º–∞–ø—ã) –µ—Å—Ç—å –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ. –ù–æ –ø–æ —Ñ–∞–∫—Ç—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É Out-of-memory –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–æ–∂–Ω–æ (*user space*), –ø–æ—ç—Ç–æ–º—É –ø–æ –¥–∏–∑–∞–π–Ω—É –º—ã –ª—É—á—à–µ –∑–∞—Ñ–µ–π–ª–∏–º—Å—è (panic - –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –Ω–µ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è).

trait Copy –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –µ—Å–ª–∏ —É –Ω–µ–≥–æ–æ –Ω–µ—Ç –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞, —Ç–æ –µ—Å—Ç—å —ç—Ç–æ—Ç —Ç–∏–ø —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–π –∏ –º–æ–∂–Ω–æ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å (memcpy)

```rust
let x = 42;
let y = x;
println!("{}", x); // OK
println!("{}", y); // OK
```

- –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã: f32, f64, bool, i8, u8, ...
- –ö–æ—Ä—Ç–µ–∂–∏ Copy-—Ç–∏–ø–æ–≤: (i16, usize)
- –ú–∞—Å—Å–∏–≤—ã Copy-—Ç–∏–ø–æ–≤: [u8; 1024]  (–Ω—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º –Ω–∞ —Å—Ç–µ–∫–µ)
- –õ—é–±–æ–π –≤–∞—à —Ç–∏–ø, –∞—Ç—Ä–∏–±—É—Ç—ã –∫–æ—Ç–æ—Ä–æ–≥–æ Copy:

```rust
#[derive(Clone, Copy)]
struct Bar {
	timestamp: u64,
}
```

Copy = memcpy (–ø–æ–±–∏—Ç–æ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ), –∞ Clone - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–π –∫–æ–¥. –ï—Å–ª–∏ –º–µ—Ç–æ–¥ –∏ Clone –∏ Copy, —Ç–æ Clone –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å memcpy

```rust
// —ç—Ç–æ –≤ —Ü–µ–ª–æ–º –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º
fn noname(_: Foo) {}

fn drop<T>(_: T) {}
```

```rust
struct Foo {
	first: ..
	second: ..
}

// –µ—Å–ª–∏ first - copy, —Ç–æ –≤—Å–µ –æ–∫, —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
// –≤ –∏–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã —Å–¥–µ–ª–∞–ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–π move, 
// –ø–æ—ç—Ç–æ–º—É –æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
drop(foo.first)
drop(foo)

// –µ—Å–ª–∏ —Ç–∞–∫–æ–π –∫–æ–¥ –∑–∞—Å—É–Ω—É—Ç—å –≤ if else, –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç
// –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–ª—è —Å–µ–±—è –ø–æ–º–µ—Ç–∏—Ç –∫–∞–∫ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –¥–µ—Å–∫—Ä—É–∫—Ç–æ—Ä
// –¥–ª—è —Ç–∞–∫–æ–≥–æ —Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

// –Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤–æ–π –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä (–Ω–µ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–π, –Ω–∞–ø–∏—Å–∞–ª–∏ –∑–∞
// –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä, —Ç–æ –¥–∞–∂–µ if-else –Ω–µ–ª—å–∑—è, –Ω—É–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã–π –æ–±—ä–µ–∫—Ç
```

–ü–ª—é—Å—ã move-—Å–µ–º–∞–Ω—Ç–∏–∫–∏ Rust: 

- –Ø–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ .clone()
- Use after move ‚Äî –æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- Move –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —É –≤—Å–µ—Ö —Ç–∏–ø–æ–≤
- Move –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä (memcpy)

–ù–æ –Ω–µ–ª—å–∑—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —Å–≤–æ–∏ –ø–æ–ª—è

```rust
fn sum(v: &Vec<i32>) -> i32 {
	v.iter().sum()
}

fn main() {
	let v = vec![1, 2, 3];
	println!("sum: {}", sum(&v));
}
```

- –°—Å—ã–ª–∫–∞ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è,
–ø–µ—Ä–µ–µ–∑–∂–∞–µ—Ç (move, –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä), –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã —Å—Å—ã–ª–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —á–∞—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–µ –±—É–¥—É—Ç
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–∞–ª—å—à–µ –≤ –∫–æ–¥–µ

–ö–∞–∫ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–≤—è–∑—å –º–µ–∂–¥—É —Å—Å—ã–ª–∫–æ–π –∏ –æ–±—ä–µ–∫—Ç–æ–º?

**–¢—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏:**

- `let x = &object`
- `let x = &object.x`
- `let x = &v[0]`

*–ù–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏* ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –º–µ—Ç–æ–¥–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π. –ß–∞—Å—Ç–æ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫–∏–µ-—Ç–æ —Å—Å—ã–ª–∫–∏, —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –Ω–µ –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Ä–∞–∑–≥–∞–¥—ã–≤–∞—Ç—å –ø–æ—Ç–∞–π–Ω–æ–π —Å–º—ã—Å–ª, –∞ —É–∫–∞–∑–∞—Ç—å —á–µ—Ç–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.

```rust
struct Point {
	x: i32,
	y: i32,
}

impl Point {
	// lifetime —Å–≤—è–∑–∞–Ω —Å –∂–∏–∑–Ω—å—é –æ–±—ä–µ–∫—Ç–∞, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —ç—Ç–æ —Å–∞–º –ø–æ–Ω—è–ª
	fn get_x(&self) -> &i32 {
		&self.x
	}
}
```

<aside>
üí° –ú–µ—Ç–æ–¥—ã —ç—Ç–æ —Ç–µ –∂–µ —Å–∞–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ —Å –¥—Ä—É–≥–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º

</aside>

–ö–æ—Ä–æ—á–µ –≥–æ–≤–æ—Ä—è, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ –≤ –º–µ—Ç–æ–¥–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É, —Ç–æ –≤—Å—ë –ø—Ä–æ—Å—Ç–æ. –ß—Ç–æ –µ—Å–ª–∏ —É –Ω–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º? –ò–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç?

–ù–∞ –≤—Ç–æ—Ä–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–æ—â–µ –æ—Ç–≤–µ—Ç–∏—Ç—å. –£ –Ω–∞—Å –µ—Å—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã, —á–µ–π –ª–∞–π—Ñ—Ç–∞–π–º ‚Äî –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã, —É –Ω–∏—Ö –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.

```rust
const ZERO: Point = Point { x: 0, y: 0 };

fn get_zero() -> &'static Point {
	&ZERO
}
```

```rust
// –ï—Å—Ç—å —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞, —á—Ç–æ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è: –ø–µ—Ä–≤—ã–π, –≤—Ç–æ—Ä–æ–π 
// –∏–ª–∏ –∂–µ –≤–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–µ–≥–æ-—Ç–æ. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –±—É–¥–µ—Ç –ø–µ—Å—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ
// –≤—ã–±–∏—Ä–∞–µ—è –Ω–∞–∏–º–µ–Ω—å—à–∏–π –ª–∞–π—Ñ—Ç–∞–π–º.
fn foo(first: &Point, second: &Point) -> &Point {
	// ...
}
```

```rust
pub fn get_farthest<'a>(first: &'a Point, second: &'a Point) -> &'a Point {
	// –∞ —Ç—É—Ç if, –≥–¥–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–¥–Ω–∞ –∏–∑ —Å—Å—ã–ª–æ–∫
	
	// –ø–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É —Å –ª–∞–π—Ñ —Ç–∞–π–º–æ–º 
	// —Ä–∞–≤–Ω—ã–º –º–µ–Ω—å—à–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –≤ –Ω–µ—ë —Å—Å—ã–ª–æ–∫
}
```

```rust
fn get<'a>(data: &'a Vec<usize>, index: &usize) -> &'a usize {}
// —Ç–æ–∂–µ —Å–∞–º–æ–µ, —á—Ç–æ
fn get<'a, 'b>(data: &'a Vec<usize>, index: &'b usize) -> &'a usize {}
// –ª—É—á—à–µ –ø–µ—Ä–≤—ã–π, —á—Ç–æ–±—ã –Ω–µ –∑–∞—à—É–º–ª—è—Ç—å –ª–∞–π—Ñ—Ç–∞–π–º–∞–º–∏
```

Lifetime elision ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ —É–∫–∞–∑—ã–≤–∞–Ω–∏—è –ª–∞–π—Ñ—Ç–∞–π–º–æ–≤..

1. –í—Å–µ –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —è–≤–Ω–æ –ª–∞–π—Ñ—Ç–∞–π–º—ã –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏:

```rust
fn do(foo: &Foo, bar: &Bar) { }
fn do<'a, 'b>(foo: &'a Foo, bar: &'b Bar) { }
```

1. –ï—Å–ª–∏ –≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –≤—Å–µ–≥–æ –æ–¥–∏–Ω –ª–∞–π—Ñ—Ç–∞–π–º, —Ç–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: 

```rust
fn get_crd(name: u8, p: &Point) -> &i32
```

1. –í –º–µ—Ç–æ–¥–∞—Ö —É –≤–æ–≤–∑—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–ø–æ–ª—á–∞–Ω–∏—é –ª–∞–π—Ñ—Ç–∞–π–º `&self`
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É –∫–∞–∂–¥–æ–π —Å—Å—ã–ª–∫–æ–π –∏ –æ–±—ä–µ–∫—Ç–æ–º, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤ –º–æ–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª—é–±–∞—è —Å—Å—ã–ª–∫–∞ –≤–∞–ª–∏–¥–Ω–∞
- –°–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–∞–π—Ñ—Ç–∞–π–º–∞–º–∏
- –ï—Å–ª–∏ —Ç–æ—á–Ω—ã–π –ª–∞–π—Ñ—Ç–∞–π–º –≤ –º–æ–º–µ–Ω—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –Ω–µ –∏–∑–≤–µ—Å—Ç–µ–Ω, –æ–Ω –ø–µ—Å—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è

```rust
fn set_x(x: &mut i32, value: i32) { } // –∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞
```

```rust
let mut v = vec![1, 2, 3];
let r = &v[0];
v.clear(); // —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
// –Ω–æ —Å—Å—ã–ª–∫—É r –º—ã —É–∂–µ –∏—Å–ø–æ—Ä—Ç–∏–ª–∏

v.push(4); // —Ç–æ–∂–µ –Ω–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è, —Ç.–∫. –µ—Å—Ç—å –µ—â—ë –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞
```

**–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—å**:

- –°–æ–∑–¥–∞–Ω–∏–µ &mut-—Å—Å—ã–ª–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ –¥—Ä—É–≥–∏–µ —Å—Å—ã–ª–∫–∏ (const, mut) [*–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–µ –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ –¥—Ä—É–≥–∏–º–∏*]
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –ø–æ–ª—É—á–∞–µ–º memory safety

**–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:

- –ö–æ–≥–¥–∞ –≤—ã –º–µ–Ω—è–µ—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Å—ã–ª–∫–∏ –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–µ—Å—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏–∑, —Å—á–∏—Ç–∞—è, —á—Ç–æ —Ä–æ–≤–Ω–æ —ç—Ç–æ –∏ –ø—Ä–æ–∑–æ–π–¥–µ—Ç

**Disjoint references:**

```rust
User {
	login: String,
	password: String,
}

let a = &mut user.login
let b = &mut user.password
// —ç—Ç–æ –û–ö, —Ç–∞–∫ –∫–∞–∫ –º—ã —Å—Å—ã–ª–∞–µ–º—Å—è –Ω–∞ –¥–≤–µ —Ä–∞–∑–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–∏
// –ø–∞–º—è—Ç–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –ª–∞–π—Ñ—Ç–∞–π–º–æ–º
```

**–ê–ª–∏–∞—Å–∏–Ω–≥**:

- –°—Å—ã–ª–∫–∏ –∑–∞–¥–∞—é—Ç –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–∏–∞—Å–∏–Ω–≥–∞ —è–∑—ã–∫–∞
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ—Ç —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
    - –ï—Å–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ –º–æ–∂–Ω–æ –∫–ª–∞—Å—Ç—å –µ–≥–æ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä—ã
    - –ï—Å–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞, –º–æ–∂–Ω–æ –∫–ª–∞—Å—Ç—å –µ–≥–æ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä—ã
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∞–ª–∏–∞—Å–∏–Ω–≥–∞ –≤—ã—è–∞–ª—è—é—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

**Reborrowing**:

```rust
fn foo(user: &mut User) {
	bar(user); // —Ç—É—Ç –∫–∞–∫ –±—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å mov
						// –Ω–æ —ç—Ç–æ—Ç –∫–æ–¥ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
	user.login = "petya".to_string();
}

fn bar(user: &mut User) {}
```

- –ò–º–µ—è –Ω–∞ —Ä—É–∫–∞—Ö &mut T, –º–æ–∂–Ω–æ –ø–æ—Ä–æ–¥–∏—Ç—å –∏—Ö –Ω–µ—ë –¥—Ä—É–≥—É—é &mut T –∏–ª–∏ &T, –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—è –∏—Å—Ö–æ–¥–Ω—É—é
- –ò–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ:

```rust
let r1 = &*mut_user_link;
// –æ–Ω–∏ –±—É–¥—É—Ç –≤–∞–ª–∏–¥–Ω—ã, –ø–æ–∫–∞ –º—ã –Ω–µ –∑–∞–∏—Å–ø–æ–ª—å–∑—É–µ–º –º—É—Ç–∞–±–µ–ª—å–Ω—É—é
// –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å –º—É—Ç–∞–±–µ–ª—å–Ω–æ–π
// —Ç–æ –µ—Å—Ç—å –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ—è–≤–Ω—ã–π —Ä–µ–±–æ—Ä—Ä—É–∏–Ω–≥
// imp;icit reborrowing
bar(&mut *user);
```

*Disjoint mutable borrows*

- –í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏, –Ω–∞ –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–±–æ N –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, –ª–∏–±–æ 1 –Ω–µ–∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞—è
- –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ —Å–ª—É–∂–∏—Ç –¥–≤—É–º —Ü–µ–ª—è–º:
    - –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ memory safety
    - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–ª–æ–∫–∞—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (–∞–ª–∏–∞—Å–∏–Ω–≥)
- Reborrowing –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Ä–æ–∂–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏ –∏–∑ &mut T, –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—è —Å—Ç–∞—Ä—É—é

## –õ–µ–∫—Ü–∏—è 3. **Slices, Enums & pattern matching, Traits**

**Slice** - —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –≤ compile-time –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ T. –°–º–æ—Ç—Ä—è—Ç –Ω–∞ –∫–∞–∫—É—é-—Ç–æ –ø–∞–º—è—Ç—å: —Å–µ–≥–º–µ–Ω—Ç, –∫—É—á–∞, —Å—Ç–µ–∫. –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞.

–¢–∏–ø —Å–ª–∞–π—Å–∞: &[T]. –°–ª–∞–π—Å –Ω–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Å—Å–∏–≤: &[T; 5]

–°–ª–∞–π—Å—ã –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑: –º–∞—Å—Å–∏–≤–∞, –≤–µ–∫—Ç–æ—Ä–∞, –¥—Ä—É–≥–æ–≥–æ —Å–ª–∞–π—Å–∞

- &array[1..3]
- &vec[..]
- &slice_one[..5]

Mutable slice ‚Äî &mut v[..2]

–ù–∞–ø—Ä–∏–º–µ—Ä, –º—ã —Ö–æ—Ç–∏–º –≤–∑—è—Ç—å –¥–≤–∞ –º—å—é—Ç–µ–±–ª —Å–∞–ª–π—Å–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è –∫—É—Å–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ &mut v[..x], &mut v[x..], —Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ —Å–∫–æ–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä—É —Ç—Ä—É–¥–Ω–æ —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ, –ø–æ—ç—Ç–æ–º—É –µ—Å—Ç—å –º–µ—Ç–æ–¥   `let (s1,s2) = array.split_at_mut(4)`. s1[0] = 1; s2[0] = 4;

–°—Ç—Ä–æ–∫–æ–≤—ã–π —Å–ª–∞–π—Å ‚Äî &str, —Å–ª–∞–π—Å –±–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é utf-8

```rust
let string = String::from("–ü—Ä–∏–≤–µ—Ç!");
let slice = &string[..4];
// –Ω–æ –ª—É—á—à–µ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—Ç—å, —Ç.–∫. –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ –±–∞–π—Ç–æ–≤–∞—è
// –∞ utf-8 –ø–æ–¥ –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –∏–º–µ–µ—Ç —Å–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç,
// —Ç–æ –º—ã –º–æ–∂–µ–º –∑–∞—Å—Ç—Ä—è—Ç—å –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ –∫–∞–∫–æ–≥–æ-—Ç–æ —Å–∏–º–≤–æ–ª–∞
// –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ - panic!
```

```rust
let bytes = b"...";
let str_ = std::str::from_utf8(bytes).unwrap();
// –æ–¥–Ω—É —Å—Å—ã–ª–∫—É –ø–µ—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ –≤ –¥—Ä—É–≥—É—é
```

- –°–ª–∞–π—Å - —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–±—ä–µ–∫—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ç–∏–ø–∞
- –Ø–≤–ª—è—é—Ç—Å—è "—Ç–æ–ª—Å—Ç—ã–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–º" (–∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä 2 —É–∫–∞–∑–∞—Ç–µ–ª–µ–π)
- –° —Ç.–∑. borrow checker, –Ω–∏—á–µ–º –Ω–µ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ —Å–ª–∞–π—Å—ã - –∫–∞–∫ —Å–ª–∞–π—Å—ã –±–∞–π—Ç, –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π utf-8

Enum ‚Äî —ç—Ç–æ union, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å tag

```rust
enum Option<T> {
	None,
	Some(T),
}

enum Result<T, E> {
	Ok(T),
	Err(E),
}

```

```rust

enum Transport {
	Car(String),
	Bus,
	Subway,
}

fn main() {
	let car = Transport::Car(text_here);
	let subway = Transport::Subway;
}
```

![enum_storage](img/enum_storage.png)

–í –æ–±—â–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –±–æ–ª—å—à–µ, —á–µ–º size_of::<T>() + 1, —Ç.–∫. –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∏ —á—Ç–æ-—Ç–æ –µ—â—ë..

–ß–µ–º—É —Ä–∞–≤–µ–Ω `size_of::<Option<bool>>()`? –û–¥–∏–Ω –±–∞–π—Ç. –î–ª—è None bool –º–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç‚Ä¶

–ß–µ–º—É —Ä–∞–≤–µ–Ω `size_of::<Option<&T>>()`? –û—Ç–≤–µ—Ç —Ä–∞–∑–º–µ—Ä —É–∫–∞–∑–∞—Ç–µ–ª—è (8 –±–∞–π—Ç). –°—Å—ã–ª–∫–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω—É–ª–µ–≤—ã–º–∏ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

–¢–∞–∫–∂–µ —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å—Å—è –∑–∞ —Å—á–µ—Ç –ø–∞–¥–¥–∏–Ω–≥–∞, –∞ –º–æ–∂–µ—Ç ‚Ä¶ 

```rust
struct Foo {
	x: i32,
	r: &'static str, // —Ç–æ–ª—Å—Ç—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, 16 –±–∞–π—Ç (—É–∫–∞–∑–∞—Ç–µ–ª—å, –¥–ª–∏–Ω–∞)
} // 4 + 16 + 4(–¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è padding) = 24
// enum –¥–ª—è Optional<Foo> –±—É–¥–µ—Ç –∑–∞—à–∏—Ç –≤ —Å—Å—ã–ª–∫—É (—Ç.–∫. –Ω–µ –º–æ–∂–µ—Ç –ø—É—Å—Ç–æ–π)
```

```rust
// Tuple-like, struct-like
enum Shape {
	Point(i32, i32),
	Rectangle {
		x: i32,
		y: i32,
		width: i32,
		height: i32,
	},
}
```

- –Ø–≤–ª—è—é—Ç—Å—è tagged union: —Ö—Ä–∞–Ω—è—Ç –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç + –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ —Ç–∏–ø–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —è–∑—ã–∫–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö
–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∏–ø–∞

```rust
// —É—Ä–∞ —Ö–∞—Å–∫–µ–ª—å!!!

let v = vec![1, 2, 3];
match v.first() { // .first() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É
	Some(x) => { // —Ç—É—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞
		...
		// –±–ª–æ–∫ –∫–æ–¥–∞
	}
	None => ... // inline –≤—ã–∑–æ–≤
}
```

```rust
struct Book {
	// ...
	author: Option<String>,
}

fn foo(book: &Book) {
	// Match and move
	match book.author {
		Some(ref author) => println!(), // —É –Ω–∞—Å —Ç–∏–ø –Ω–µ Copy, –Ω–∞–º –Ω–µ–ª—å–∑—è move
		// —Ç.–∫. —É –Ω–∞—Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞
		None => println!(),	
	};

	match &book.author { // –º–æ–∂–Ω–æ –∏ —Ç–∞–∫
		Some(author) => println!(),
		None => println!(),	
	};

	// ...

	match byte {
		0..=127 => true,
		128...=255 => false,
	};

	match book.country.as_str() { // —Å—Ç—Ä–æ–∫–æ–≤—ã–π —Å–ª–∞–π—Å, country: String
		"russia" | "ru" => true,
		_ => false,
	};
	
	// match guards
	match book.country.as_deref() { // country: Option<String>
		// –¥–≤–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏, –µ—Å–ª–∏ –º—ã –Ω–µ —Å–º–∞—Ç—á–∏–ª–∏—Å—å
		Some(s) if s.to_lowercase() == "ru" => true,
		Some(s) if s.to_lowercase() == "russia" => true,
		
		// –∏–ª–∏ –∂–µ
		// —Ç—É—Ç –æ–¥–Ω–∞ –∞–ª–ª–æ–∫–∞—Ü–∏—è
		Some(s) => matches!(s.to_lowercase().as_str(), "ru" | "russia"),
		_ => false,
	};
	
	// match –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö
	// –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–æ–¥—Å–∫–∞–∂–µ—Ç, –µ—Å–ª–∏ –º—ã –∑–∞–±—É–µ–º –∫–∞–∫–æ–π-—Ç–æ –∫–µ–π—Å
	match p {
		Point { x: 0, .. } | Point { y: 0, .. } => None,
		Point { x: 1.., y: 1.. } => Some(0),
		Point { x: i32::MIN..=-1, y: 1.. } => Some(1),
		Point { x: i32::MIN..=-1, y: i32::MIN..=-1 } => Some(2),
		Point { x: 1.., y: i32::MIN..=-1 } => Some(3),
	}

	// –°–ª–∞–π—Å
	match binary {
		[0x7f, b'E', b'L', b'F', ..] => true,
		_ => false,
	}
}
```

```rust
// Refutability - –æ—Ç–≤–µ—Ä–≥–∞–µ–º–æ—Å—Ç—å
// Irrefutable pattern - –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç

x => { }
Point { x, y } => { }
Point { x, .. } => { } // –º–æ–∂–Ω–æ –Ω–µ –≤—Å–µ –ø–æ–ª—è –ø–∏—Å–∞—Ç—å
											// –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ
(x, _) => { }        // –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

fn get_radius_squared(point: (i32, i32)) -> i32 {
	let (x, y) = point;
	x * x + y * y
}

fn do_stuff(context: &Context) {
	// –ø–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏
	// –∏–º—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
	let Context { config, logger, .. } = context;
	// ...
}
```

```rust
let points = vec![
	(0, 0),
	(3, 5),
];

for &(x, y) in points.iter() {
	// ...
}
```

```rust
let mut vec = vec![1, 2, 3];
if let Some(x) = vec.pop() {
	// ...
}

// if let, while let —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —è–∑—ã–∫–∞
let mut queue: VecDeque<_> = vec![source].into();
while let Some(vert) = queue.pop_front() {
	// ...
}
```

```rust
let Some(Message::StartGame(start_game)) = read_message(&mut reader) else {
	panic!("expected the first message to be 'start_game'");
};

// Else –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
// return
// break
// panic
// –õ—é–±–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º —Ç–∏–ø–æ–º ‚Äú!‚Äù
```

- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è match –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–±—Ä–∞—Ç—å –ø–æ –ø–æ—Ä—è–¥–∫—É —à–∞–±–ª–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—Ç—å
- –í–µ—Ç–≤–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ match –¥–æ–ª–∂–Ω—ã –ø–æ–∫—Ä—ã–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏
- Irrefutable patterns –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ let, for –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞—Ö
- Refutable patterns –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ if let, while –∏ let/else

```rust
// –ü–æ—á—Ç–∏ –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

trait Rule {
	fn process(&self, packet: &IpPacket) -> Option<Outcome>;
}

impl Rule for ForwardingRule {
	fn process(&self, packet: &IpPacket) -> Option<Outcome> { /* ... */}
}

impl Rule for BlockingRule {
	fn process(&self, packet: &IpPacket) -> Option<Outcome> { /* ... */}
}

let fwd_rule = ForwardingRule { /* ... */ };
let rule: &dyn Rule = &fwd_rule; // –∫–∞—Å—Ç —Å—Å—ã–ª–∫–∏
// dispatch ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –≤ —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, 
// –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω—É –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
//  –æ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ç–∏–ø–æ–≤ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ 
// (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö 
// —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è).
rule.process(&ip_packet);
```

–ü–æ—á–µ–º—É &dyn Trait, –∞ –Ω–µ &Trait?
‚óè
‚óè
&dyn Trait - —ç—Ç–æ —Ç–æ–ª—Å—Ç—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å (fat pointer)
&dyn Trait —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è: –Ω–∞ –æ–±—ä–µ–∫—Ç –∏ –Ω–∞ –µ–≥–æ vtable

Box ‚Äî –≤–ª–∞–¥–µ—é—â–∏–π —É–∫–∞–∑–∞—Ç–µ–ª—å –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –∫—É—á–µ, —Ç–∏–ø –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞—Ä–∞–Ω–µ–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω. –û–±—ã—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–µ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç –æ–±—ä–µ–∫—Ç –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∫–æ—É–ø–∞, –∞ Box –¥–µ–ª–∞–µ—Ç —ç—Ç–æ.

–¢–∞–±–ª–∏—Ü–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–π –ª–µ–∂–∏—Ç –≤ —Å–µ–≥–º–µ–Ω—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

```rust
// dyn —Å—Ç–æ–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Ç—É—Ç —Ç–æ–ª—Å—Ç—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å
let rule: Box<dyn Rule> = Box::new(ForwardingRule { /* ... */ });
```

## –õ–µ–∫—Ü–∏—è 4. **Generics & static dispatch. –£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏**

–ú—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–µ–π—Ç Trait –¥–ª—è —Ç–∏–ø–∞ T, –µ—Å–ª–∏:

- –¢–∏–ø T –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –Ω–∞—à–µ–º –∫—Ä–µ–π—Ç–µ (*–ø–æ–∫–∞ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–∞—à –ø—Ä–æ–µ–∫—Ç*)
- –ò–ª–∏ —Ç—Ä–µ–π—Ç Trait –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –Ω–∞—à–µ–º –∫–µ–π—Ç–µ

fully qualified

## –õ–µ–∫—Ü–∏—è N. –ú–∞–∫—Ä–æ—Å—ã

–ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤ –°–∏ –∏ ++ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —è–∑—ã–∫, —Ç–æ –µ—Å—Ç—å —Å–≤–æ–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç. –í Rust –º–∞–∫—Ä–æ—Å—ã —è–≤–ª—è—é—Ç—Å—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–æ–¥. –ê –∑–∞—á–µ–º —ç—Ç–æ?

- Domain-specific —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä, json
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∏–Ω–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç –ø–æ–¥—É–º–∞—Ç—å, –Ω–µ –Ω—É–∂–Ω–∞ –ª–∏ –Ω–∞–º –≤—Å—ë-—Ç–∞–∫–∏ —Ñ—É–Ω–∫—Ü–∏—è)
- Compile-time –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Ç–æ–≤ –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é (derive ‚Ä¶)
- –†–µ—Ñ–ª–µ–∫—Å–∏—è

–°—É—â–µ—Å—Ç–≤—É—é—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã (!vec[]) –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ (derive –∫ –ø—Ä–∏–º–µ—Ä—É).

<[_]> ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä, –¥–æ–≥–∞–¥–∞–π—Å—è –∫–∞–∫–æ–π —Ç—É—Ç —Ç–∏–ø, —Ç–∞–∫ –æ–Ω –µ—â—ë –∏ –º–∞—Å—Å–∏–≤, –∞ –∫–∞–∫ –ø–æ–π–º–µ—à—å –ø–æ–¥—Å—Ç–∞–≤—å –µ–≥–æ –≤ <>

–ü—Ä–æ–±–µ–ª (–∫ —Ç–æ–º—É –∂–µ \n, \t) ‚Äî –Ω–µ —Ç–æ–∫–µ–Ω, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ –º–∞–∫—Ä–æ—Å—ã.

–ü—Ä–µ—Ü–µ–¥–µ–Ω—Ç–Ω–æ—Å—Ç—å?
